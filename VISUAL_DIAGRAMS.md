# Visual Architecture & Flow Diagrams

## System Architecture Diagram

```
???????????????????????????????????????????????????????????????
?                    ANGULAR FRONTEND                         ?
?              (localhost:4200)                               ?
???????????????????????????????????????????????????????????????
?                                                             ?
?  ???????????????????      ????????????????????            ?
?  ?   Navigation    ?      ?   Auth Service   ?            ?
?  ?   (navbar)      ????????   (core logic)   ?            ?
?  ???????????????????      ????????????????????            ?
?           ?                        ?                       ?
?      [Login/Signup              [HTTP                      ?
?       Links]                    Requests]                  ?
?           ?                        ?                       ?
?  ???????????????????      ????????????????????            ?
?  ? Signup Component?      ? Login Component  ?            ?
?  ? - Form Fields   ?      ? - Form Fields    ?            ?
?  ? - Validation    ?      ? - Token Storage  ?            ?
?  ? - Role Dropdown ?      ? - Redirect Logic ?            ?
?  ? - Error Display ?      ? - User Info      ?            ?
?  ???????????????????      ????????????????????            ?
?           ?                        ?                       ?
?           ??????????????????????????                       ?
?                        ?                                   ?
?                   [Observables]                            ?
?                        ?                                   ?
???????????????????????????????????????????????????????????????
                         ?
                    [HTTPS/TLS]
                         ?
???????????????????????????????????????????????????????????????
?            .NET 8 BACKEND                                  ?
?     (localhost:7107)                                        ?
???????????????????????????????????????????????????????????????
?                                                             ?
?  ????????????????????????????????????????????????????     ?
?  ?        AuthController                           ?     ?
?  ????????????????????????????????????????????????????     ?
?  ? [GET]    /api/auth/roles                        ?     ?
?  ? [POST]   /api/auth/signup                       ?     ?
?  ? [POST]   /api/auth/login                        ?     ?
?  ? [GET]    /api/auth/whoami                       ?     ?
?  ? [GET]    /api/auth/profile/{id}                 ?     ?
?  ????????????????????????????????????????????????????    ?
?            ?                                               ?
?       [Business Logic]                                    ?
?            ?                                               ?
?  ?????????????????????????????????????????????????????   ?
?  ?        Services Layer                            ?   ?
?  ????????????????????????????????????????????????????   ?
?  ? - TokenService (JWT generation)                ?   ?
?  ? - PasswordHasher (encryption)                  ?   ?
?  ? - EfUserStore (user management)                ?   ?
?  ????????????????????????????????????????????????????   ?
?            ?                                               ?
?       [ORM Queries]                                       ?
?            ?                                               ?
?  ?????????????????????????????????????????????????????   ?
?  ?   Entity Framework Core 8                       ?   ?
?  ?   - DbContext: ApplicationDbContext             ?   ?
?  ?   - Models: User, Role, UserRole, NewJoiner    ?   ?
?  ????????????????????????????????????????????????????   ?
?            ?                                               ?
?       [SQL Queries]                                       ?
?            ?                                               ?
?  ?????????????????????????????????????????????????????   ?
?  ?      SQL SERVER 2019+                           ?   ?
?  ?      Database: "Bdo"                            ?   ?
?  ????????????????????????????????????????????????????   ?
?  ? Tables:                                         ?   ?
?  ? - Users (Id, Username, Email, PasswordHash)    ?   ?
?  ? - Roles (Id, Name)                             ?   ?
?  ? - UserRoles (UserId, RoleId)                   ?   ?
?  ? - NewJoiners (employee onboarding data)        ?   ?
?  ????????????????????????????????????????????????????   ?
?                                                             ?
???????????????????????????????????????????????????????????????
```

## Signup Flow Diagram

```
START
  ?
  ?? User navigates to /signup
  ?
  ?? Angular loads SignupComponent
  ?
  ?? ngOnInit() triggered
  ?  ?
  ?  ?? AuthService.getAvailableRoles()
  ?     ?
  ?     ?? HTTP GET /api/auth/roles
  ?        ?
  ?        ?? Backend queries Roles table
  ?           ?
  ?           ?? Returns RoleDto[]
  ?
  ?? Roles populate dropdown
  ?
  ?? User fills form:
  ?  ?? username
  ?  ?? email
  ?  ?? password
  ?  ?? confirmPassword
  ?  ?? select role
  ?
  ?? User clicks "Create Account"
  ?
  ?? Client-side validation
  ?  ?? All fields filled?              ?????? [NO] ??? Show error ???
  ?  ?? Passwords match?                 ?????? [NO] ??? Show error ???
  ?  ?? Password >= 6 chars?             ?????? [NO] ??? Show error ???
  ?  ?? Valid email format?              ?????? [NO] ??? Show error ???
  ?     [ALL PASS]                                                      ?
  ?         ?                                                           ?
  ?         ?? Create SignupRequest                                    ?
  ?            ?                                                        ?
  ?            ?? HTTP POST /api/auth/signup                          ?
  ?               ?                                                    ?
  ?               ?? Backend validation:                              ?
  ?                  ?? Role exists?         ??? [NO] ??? 400 ????????
  ?                  ?? Username unique?     ??? [NO] ??? 400 ????????
  ?                  ?? Email unique?        ??? [NO] ??? 400 ????????
  ?                  ?? Password valid?      ??? [NO] ??? 400 ????????
  ?                  ?? [ALL VALID]
  ?                     ?
  ?                     ?? Create User
  ?                        ?
  ?                        ?? Create UserRole
  ?                           ?
  ?                           ?? Save to DB
  ?                              ?
  ?                              ?? Return 201 Created
  ?                                 with SignupResponse
  ?
  ?? Response received
  ?
  ?? Show success message:
  ?  "Account created successfully! Redirecting..."
  ?
  ?? Wait 1.5 seconds
  ?
  ?? router.navigate(['/login'])
  ?
  ?? User sees LoginComponent
  ?
  ?? User enters credentials
  ?
  ?? Login successful
  ?
  ?? Check role:
  ?  ?? [Admin] ??? router.navigate(['/new-joiner'])
  ?  ?? [Other] ??? router.navigate(['/'])
  ?
  ?? END
```

## Component Dependency Graph

```
app-routing.module.ts
?
?? HomeComponent
?
?? LoginComponent
?  ?
?  ?? AuthService
?     ?? HttpClient
?
?? SignupComponent (NEW)
?  ?
?  ?? AuthService
?  ?  ?? HttpClient
?  ?
?  ?? Router
?  ?
?  ?? CommonModule
?  ?
?  ?? FormsModule
?
?? NewJoinerComponent
   ?
   ?? (Protected by AuthGuard & RoleGuard)
```

## Data Model Relationships

```
Users Table
???????????????????????????
? Id (PK)                 ?
? Username (UNIQUE)       ?
? Email                   ?
? PasswordHash            ?
? IsActive                ?
???????????????????????????
           ?
           ? 1:N
           ?
???????????????????????????
? UserRoles               ?
???????????????????????????
? UserId (FK, PK)         ?
? RoleId (FK, PK)         ?
???????????????????????????
           ?
           ? N:1
           ?
???????????????????????????
? Roles Table             ?
???????????????????????????
? Id (PK)                 ?
? Name (UNIQUE)           ?
? Examples:               ?
? - Admin                 ?
? - User                  ?
? - Manager               ?
???????????????????????????

NewJoiners Table
???????????????????????????
? Id (PK)                 ?
? FullName                ?
? Email (UNIQUE + StartDate) ?
? Department              ?
? ManagerName             ?
? StartDate               ?
? CreatedAtUtc            ?
? WelcomeEmailSentAtUtc   ?
? LastSendError           ?
???????????????????????????
```

## HTTP Request/Response Flow

```
FRONTEND                          BACKEND
   ?                                 ?
   ?? [1] GET /api/auth/roles       ?
   ??????????????????????????????????>?
   ?                              [Query DB]
   ?<? [2] 200 OK                    ?
   ?  [{id: 1, name: "Admin"}, ...]  ?
   ?                                 ?
   ? [User fills form & submits]     ?
   ?                                 ?
   ?? [3] POST /api/auth/signup      ?
   ??????????????????????????????????>?
   ?  {                              ?
   ?    "username": "john_doe",      ?
   ?    "email": "john@ex.com",      ?
   ?    "password": "Secure123!",    ?
   ?    "roleId": 2                  ?
   ?  }                              ?
   ?                          [Validate input]
   ?                          [Hash password]
   ?                          [Create user]
   ?                          [Create UserRole]
   ?                          [Save to DB]
   ?                                 ?
   ?<? [4] 201 Created               ?
   ?  {                              ?
   ?    "userId": 5,                 ?
   ?    "username": "john_doe",      ?
   ?    "email": "john@ex.com",      ?
   ?    "message": "..."             ?
   ?  }                              ?
   ?                                 ?
   ?? [5] Show success message       ?
   ?                                 ?
   ?? [6] Redirect to /login         ?
   ?                                 ?
   ?? [7] POST /api/auth/login       ?
   ??????????????????????????????????>?
   ?  {                              ?
   ?    "username": "john_doe",      ?
   ?    "password": "Secure123!"     ?
   ?  }                              ?
   ?                          [Find user]
   ?                          [Verify password]
   ?                          [Generate JWT]
   ?                                 ?
   ?<? [8] 200 OK                    ?
   ?  {                              ?
   ?    "token": "eyJ...",           ?
   ?    "expires": "2024-01-01T...", ?
   ?    "roles": ["User"]            ?
   ?  }                              ?
   ?                                 ?
   ?? [9] Save token to localStorage ?
   ?                                 ?
   ?? [10] Redirect based on role    ?
```

## State Management Flow

```
LocalStorage
????????????????????
? jwt_token: "..." ?
????????????????????
          ?
          ? (on app load)
          ?
          ?
    AuthService
    ???????????????????????????
    ? Private loggedIn:       ?
    ? BehaviorSubject<bool>   ?
    ?                         ?
    ? Public methods:         ?
    ? - getToken()            ?
    ? - isLoggedIn()          ?
    ? - isAuthenticated()     ?
    ? - getRoles()            ?
    ? - login()               ?
    ? - signup()              ?
    ? - logout()              ?
    ? - saveToken()           ?
    ? - getAvailableRoles()   ?
    ???????????????????????????
               ?
               ? (injected into)
               ?
        ????????????????
        ? All          ?
        ? Components   ?
        ?              ?
        ? LoginComp    ?
        ? SignupComp   ?
        ? NavbarComp   ?
        ? etc...       ?
        ????????????????
```

## Error Handling Flow

```
?? User Submits Form
?
?? Client Validation
?  ?
?  ?? Failed? ??? Show error ??? User can retry
?  ?
?  ?? Passed? ??? Continue
?
?? Send Request
?  ?
?  ?? Network Error (status 0)
?  ?  ?
?  ?  ?? Show: "Cannot reach server"
?  ?
?  ?? Bad Request (400)
?  ?  ?
?  ?  ?? Parse error.error.message
?  ?  ?
?  ?  ?? Show specific error:
?  ?     ?? "Username already exists"
?  ?     ?? "Email already registered"
?  ?     ?? "Invalid role selected"
?  ?     ?? etc...
?  ?
?  ?? Server Error (500)
?  ?  ?
?  ?  ?? Show: "Server error"
?  ?
?  ?? Success (201)
?     ?
?     ?? Show success ??? Redirect
?
?? End

```

## Security Architecture

```
??????????????????????????????????????????????
?           SECURITY LAYERS                  ?
??????????????????????????????????????????????
?                                            ?
?  TRANSPORT (Layer 1)                       ?
?  ?? HTTPS/TLS encryption                  ?
?  ?? Certificate validation                ?
?  ?? Man-in-the-middle attack prevention   ?
?                                            ?
?  INPUT VALIDATION (Layer 2)                ?
?  ?? Client-side validation                ?
?  ?? Server-side validation                ?
?  ?? Email format check                    ?
?  ?? Username format check                 ?
?  ?? Password complexity check             ?
?                                            ?
?  AUTHENTICATION (Layer 3)                  ?
?  ?? Password hashing (PasswordHasher)     ?
?  ?? JWT token generation                  ?
?  ?? Token storage (localStorage)          ?
?  ?? Token validation on requests          ?
?                                            ?
?  AUTHORIZATION (Layer 4)                   ?
?  ?? Role-based access control             ?
?  ?? AuthGuard (logged in?)                ?
?  ?? RoleGuard (correct role?)             ?
?  ?? Route protection                      ?
?                                            ?
?  DATA INTEGRITY (Layer 5)                  ?
?  ?? Unique constraints (DB)               ?
?  ?? Foreign key constraints               ?
?  ?? Indexed lookups                       ?
?  ?? Transaction management                ?
?                                            ?
?  XSS PREVENTION (Layer 6)                  ?
?  ?? Angular templating sanitization      ?
?  ?? DOMSanitizer (if needed)              ?
?  ?? Content Security Policy               ?
?                                            ?
??????????????????????????????????????????????
```

## Deployment Architecture

```
DEVELOPMENT
?? Frontend: http://localhost:4200
?? Backend: https://localhost:7107
?? Database: LocalDB/SQL Server (local)

STAGING
?? Frontend: https://staging.portal.internal
?? Backend: https://api.staging.internal
?? Database: SQL Server (staging)

PRODUCTION
?? Frontend: https://portal.company.com (CDN)
?? Backend: https://api.company.com (App Service/VM)
?? Database: SQL Server (managed service)
?? SSL/TLS: Certified & enforced
```

---

These diagrams provide a comprehensive visual representation of:
- System architecture
- Data flows
- Component relationships
- Security layers
- Deployment topology



+-----------------------------------------------------------+
|                    ANGULAR FRONTEND                       |
|                    http://localhost:4200                  |
+-----------------------------------------------------------+
|                                                           |
|  +-------------------+     +----------------------------+ |
|  | Navigation (Nav)  | --> | AuthService (Core Logic)   | |
|  | - Login / Signup  |     | - HTTP Requests            | |
|  +-------------------+     +----------------------------+ |
|            |                           |                  |
|            v                           v                  |
|  +-------------------+     +----------------------------+ |
|  | Signup Component  |     | Login Component             | |
|  | - Form            |     | - Form                     | |
|  | - Validation      |     | - Token Storage            | |
|  | - Role Dropdown   |     | - Redirect Logic           | |
|  | - Error Display   |     | - User Info                | |
|  +-------------------+     +----------------------------+ |
|                \______________ Observables ______________/|
+-----------------------------------------------------------+
                          |
                          | HTTPS / TLS
                          v
+-----------------------------------------------------------+
|                     .NET 8 BACKEND                        |
|                  https://localhost:7107                  |
+-----------------------------------------------------------+
|                                                           |
|  +-----------------------------------------------------+  |
|  | AuthController                                      |  |
|  |-----------------------------------------------------|  |
|  | GET    /api/auth/roles                              |  |
|  | POST   /api/auth/signup                             |  |
|  | POST   /api/auth/login                              |  |
|  | GET    /api/auth/whoami                             |  |
|  | GET    /api/auth/profile/{id}                       |  |
|  +-----------------------------------------------------+  |
|                         |                                 |
|                   Business Logic                          |
|                         |                                 |
|  +-----------------------------------------------------+  |
|  | Services Layer                                      |  |
|  | - TokenService (JWT)                                |  |
|  | - PasswordHasher                                   |  |
|  | - EfUserStore                                      |  |
|  +-----------------------------------------------------+  |
|                         |                                 |
|                   ORM (EF Core 8)                         |
|                         |                                 |
|  +-----------------------------------------------------+  |
|  | ApplicationDbContext                                |  |
|  | Models: User, Role, UserRole, NewJoiner              |  |
|  +-----------------------------------------------------+  |
|                         |                                 |
|                    SQL Server                            |
|                         |                                 |
|  +-----------------------------------------------------+  |
|  | Database: Bdo                                       |  |
|  | Tables: Users, Roles, UserRoles, NewJoiners          |  |
|  +-----------------------------------------------------+  |
+-----------------------------------------------------------+



START
  |
  v
User navigates to /signup
  |
  v
Angular loads SignupComponent
  |
  v
ngOnInit()
  |
  v
GET /api/auth/roles
  |
  v
Roles loaded into dropdown
  |
  v
User fills form:
- Username
- Email
- Password
- Confirm Password
- Role
  |
  v
Click "Create Account"
  |
  v
Client-side validation
  |-- Missing fields? ----------> Show error
  |-- Password mismatch? -------> Show error
  |-- Weak password? -----------> Show error
  |-- Invalid email? -----------> Show error
  |
  v
POST /api/auth/signup
  |
  v
Backend validation
  |-- Role invalid? ------------> 400
  |-- Username exists? ---------> 400
  |-- Email exists? ------------> 400
  |
  v
Create User + UserRole
  |
  v
Save to database
  |
  v
201 Created
  |
  v
Show success message
  |
  v
Redirect to /login
  |
  v
Login successful
  |
  v
Role check
  |-- Admin  ---> /new-joiner
  |-- Others ---> /
  |
  v
END



app-routing.module.ts
 |
 +--> HomeComponent
 |
 +--> LoginComponent
 |      |
 |      +--> AuthService
 |             |
 |             +--> HttpClient
 |
 +--> SignupComponent
 |      |
 |      +--> AuthService
 |      +--> Router
 |      +--> CommonModule
 |      +--> FormsModule
 |
 +--> NewJoinerComponent
        |
        +--> AuthGuard
        +--> RoleGuard



Users
+----------------------+
| Id (PK)              |
| Username (UNIQUE)    |
| Email                |
| PasswordHash         |
| IsActive             |
+----------+-----------+
           |
           | 1..N
           v
UserRoles
+----------------------+
| UserId (PK, FK)      |
| RoleId (PK, FK)      |
+----------+-----------+
           |
           | N..1
           v
Roles
+----------------------+
| Id (PK)              |
| Name (UNIQUE)        |
| Admin / User / Mgr   |
+----------------------+

NewJoiners
+-----------------------------+
| Id (PK)                     |
| FullName                    |
| Email (UNIQUE + StartDate)  |
| Department                  |
| ManagerName                 |
| StartDate                   |
| CreatedAtUtc                |
| WelcomeEmailSentAtUtc       |
| LastSendError               |
+-----------------------------+



Frontend                         Backend
----------------------------------------------------------
GET /api/auth/roles  ----------> Query Roles
<---------- 200 OK              Return RoleDto[]

POST /api/auth/signup ---------> Validate input
                                 Hash password
                                 Create User
                                 Create UserRole
                                 Save DB
<---------- 201 Created          SignupResponse

POST /api/auth/login ----------> Verify credentials
                                 Generate JWT
<---------- 200 OK               Token + Roles

Save token to localStorage
Redirect based on role



Submit Form
   |
Client Validation
   |-- Failed ---> Show error
   |
Send Request
   |-- Network error (0) ---> "Cannot reach server"
   |-- 400 Bad Request ---> Show backend message
   |-- 500 Error --------> "Server error"
   |
Success (201)
   |
Show success + Redirect



+--------------------------------------------------+
|                 SECURITY LAYERS                  |
+--------------------------------------------------+
| Transport Security                              |
| - HTTPS / TLS                                   |
| - Certificate validation                        |
+--------------------------------------------------+
| Input Validation                                |
| - Client-side                                  |
| - Server-side                                  |
+--------------------------------------------------+
| Authentication                                  |
| - Password hashing                              |
| - JWT issuance                                  |
+--------------------------------------------------+
| Authorization                                   |
| - Role-based access control                     |
| - AuthGuard / RoleGuard                         |
+--------------------------------------------------+
| Data Integrity                                  |
| - Unique constraints                            |
| - Foreign keys                                  |
| - Transactions                                  |
+--------------------------------------------------+
| XSS Protection                                  |
| - Angular sanitization                          |
| - CSP headers                                   |
+--------------------------------------------------+